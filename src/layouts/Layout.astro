---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

interface Props {
  title: string;
  description?: string;
  skipDefaultStructuredData?: boolean;
}

const { title, description = "Turn your recipe screenshots into organized meals you actually cook. Import any recipe - screenshots, handwritten cards, Instagram saves. Join 50,000+ home cooks who went from recipe chaos to confident cooking.", skipDefaultStructuredData = false } = Astro.props;
const primaryKeyword = "recipe app";
const secondaryKeywords = "best recipe app, recipe planner app, meal planner app, AI meal planning, recipe organizer app, digital cookbook app";

// Language detection and hreflang generation
const currentPath = Astro.url.pathname;
const currentLang = currentPath.startsWith('/de/') ? 'de' : currentPath.startsWith('/en/') ? 'en' : 'en';
const baseUrl = 'https://taste-buddy.app';

// Generate hreflang URLs
function getHreflangUrls(path: string) {
  // Remove language prefix if it exists
  let cleanPath = path.replace(/^\/(en|de)\//, '/');
  if (cleanPath === '/') cleanPath = '';
  
  return {
    en: `${baseUrl}/en${cleanPath}`,
    de: `${baseUrl}/de${cleanPath}`,
    'x-default': `${baseUrl}${cleanPath}` // Default to no language prefix
  };
}

const hreflangUrls = getHreflangUrls(currentPath);

const structuredData = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "SoftwareApplication",
      "name": "TasteBuddy - Best Recipe App & AI Meal Planner",
      "applicationCategory": ["LifestyleApplication", "FoodApplication", "ProductivityApplication"],
      "operatingSystem": ["iOS", "Android"],
      "description": "The best recipe app and AI meal planner for home cooks. Organize recipes, generate meal plans, create shopping lists, and transform recipes for dietary needs.",
      "keywords": "recipe app, best recipe app, recipe planner app, meal planner app, AI meal planning, recipe organizer, AI cooking assistant",
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "150"
      },
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "AI-powered meal planning and recipe suggestions",
        "Smart recipe organization with dietary filters",
        "Automatic shopping list generation from meal plans",
        "Recipe image generation and visual cookbook creation",
        "Recipe import from any website or photo",
        "Dietary transformation (vegan, gluten-free, low-carb)",
        "OCR recipe scanning from cookbooks and magazines",
        "Cloud sync across all devices",
        "Shareable digital cookbooks"
      ],
      "downloadUrl": ["https://apps.apple.com/app/id6554007741", "https://play.google.com/store/apps/details?id=app.tastebuddy"],
      "screenshot": "/images/screenshots.png",
      "publisher": {
        "@id": "https://www.taste-buddy.app/#organization"
      }
    },
    {
      "@type": "Organization",
      "@id": "https://www.taste-buddy.app/#organization",
      "name": "TasteBuddy",
      "url": "https://www.taste-buddy.app",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.taste-buddy.app/images/logo.png"
      },
      "description": "Developer of the TasteBuddy AI-powered recipe management and meal planning application",
      "foundingDate": "2024",
      "sameAs": [
        "https://apps.apple.com/app/id6554007741",
        "https://play.google.com/store/apps/details?id=app.tastebuddy"
      ]
    }
  ]
};

---

<!doctype html>
<html lang={currentLang} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta property="og:description" content={description} />
    <meta name="viewport" content="width=device-width" />
    
    <!-- Core Web Vitals Optimizations -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://apps.apple.com">
    <link rel="preconnect" href="https://play.google.com">
    
    <!-- Font loading optimization -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- DNS prefetch for external domains -->
    <link rel="dns-prefetch" href="//apps.apple.com">
    <link rel="dns-prefetch" href="//play.google.com">
    <link rel="dns-prefetch" href="//taste-buddy.app">
    
    <!-- Preload critical above-the-fold images -->
    <link rel="preload" href="/AppIcon.png" as="image" type="image/png">
    <link rel="preload" href="/images/screenshots.png" as="image" type="image/png">
    <meta name="description" content={description} />
    <meta name="robots" content="index, follow" />
    <meta name="keywords" content={`${primaryKeyword}, ${secondaryKeywords}, all recipe app, recipe planner app free, meal planning app, cooking app, hands-free cooking, iOS app, Android app, kitchen assistant, AI recipe suggestions`} />
    <meta property="og:description" content={description} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content="/images/screenshots.png" />
    <link rel="canonical" href={Astro.url.href} />
    
    <!-- Hreflang tags for international SEO -->
    <link rel="alternate" hreflang="en" href={hreflangUrls.en} />
    <link rel="alternate" hreflang="de" href={hreflangUrls.de} />
    <link rel="alternate" hreflang="x-default" href={hreflangUrls['x-default']} />
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>{title || "Recipe Keeper App | TasteBuddy"}</title>
    {!skipDefaultStructuredData && (
      <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
    )}
  </head>
  <body class="min-h-screen flex flex-col bg-[#10130B] font-['Inter',sans-serif] text-gray-100">
    <Header />
    
    <main class="flex-grow">
      <slot />
    </main>

    <Footer />
  </body>
</html>

<style is:global>
  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  
  ::-webkit-scrollbar-track {
    background: rgba(26, 29, 20, 0.3);
  }
  
  ::-webkit-scrollbar-thumb {
    background: rgba(42, 45, 36, 0.5);
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: rgba(42, 45, 36, 0.8);
  }
  
  /* Button styles */
  .btn-primary {
    @apply bg-gradient-to-r from-[#00CE31] to-[#00CE31]/90 hover:from-[#00CE31]/90 hover:to-[#00CE31] text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5;
  }
  
  .btn-secondary {
    @apply bg-[#1C2513] hover:bg-[#2A2D24] border border-[#2A2D24] text-white font-medium py-3 px-6 rounded-lg transition-all duration-300;
  }
</style>
