[build]
  command = "npm run netlify-build"
  publish = "dist"

# Configure secrets scanning to omit PUBLIC environment variables which are not secrets
[build.environment]
  NODE_VERSION = "18.20.0"
  NPM_VERSION = "9.8.1"
  NODE_ENV = "production"
  ROLLUP_SKIP_NODEJS = "true"
  NPM_CONFIG_LEGACY_PEER_DEPS = "true"
  SECRETS_SCAN_OMIT_KEYS = "PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_ANON_KEY"

# Function configuration
[functions]
  node_bundler = "esbuild"
  # Directory where functions are stored (this is important for Astro SSR)
  directory = ".netlify/functions-internal"

[[plugins]]
  package = "@netlify/plugin-emails"

# Remove the previous redirect and use Astro's recommended redirects
[[redirects]]
  from = "/_astro/*"
  to = "/_astro/:splat"
  status = 200

[[redirects]]
  from = "/share_recipe/*"
  to = "/.netlify/functions/entry"
  status = 200
  force = true

# Fallback for all other routes (static pages)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
