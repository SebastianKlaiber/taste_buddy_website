[build]
  command = "npm run netlify-build"
  publish = "dist"

# Configure environment variables
[build.environment]
  # Use Ubuntu 24.04 (Noble) build image instead of deprecated Focal
  NETLIFY_IMAGE_SELECTION = "noble"
  NODE_VERSION = "22"
  NPM_VERSION = "10"
  NODE_ENV = "production"
  ROLLUP_SKIP_NODEJS = "true"
  NPM_CONFIG_LEGACY_PEER_DEPS = "true"
  SECRETS_SCAN_OMIT_KEYS = "PUBLIC_SUPABASE_URL,PUBLIC_SUPABASE_ANON_KEY"
  # Make it clearer where build outputs go for debugging
  DEBUG = "astro:*"
  # Disable log output hiding to help debug build issues
  NETLIFY_EXPERIMENTAL_BUILD_LOGS_HIDE_POTENTIAL_SECRETS = "false"

# Function configuration
[functions]
  node_bundler = "esbuild"
  # Ensure this points to the correct directory where functions are generated
  directory = ".netlify/functions"

[[plugins]]
  package = "@netlify/plugin-emails"

# Tell Netlify where to find our custom 404 page
[build.processing]
  skip_processing = false
[build.processing.html]
  pretty_urls = true

# Error page handling - Let _redirects file handle specific routes
# Add catch-all 404 handler for any unmatched routes
[[redirects]]
  from = "/*"
  to = "/404.html"
  status = 404

# Custom error pages
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
